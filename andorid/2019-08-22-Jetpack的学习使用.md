layout:     post  
title:      Jetpack的学习使用 
subtitle:   Jetpack
date:       2019-08-22
author:     小卷子
header-img: img/tag-bg.jpg
catalog: true
tags:

- 标签

[TOC]




## Navigation

`Navigation`是一个可简化Android导航的库和插件，更确切的来说，`Navigation`是用来管理`Fragment`的切换，并且可以通过可视化的方式，看见App的交互流程。

使用Navigation的步骤

**准备工作**

添加依赖

~~~java
    implementation "androidx.navigation:navigation-fragment-ktx:$rootProject.navigationVersion"
    implementation "androidx.navigation:navigation-ui-ktx:$rootProject.navigationVersion"
~~~



先创建好Activity和Fragment和对应的布局文件

**1.在Activity 布局中声明 NavGraphFragment**

~~~java
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:app="http://schemas.android.com/apk/res-auto"
        android:orientation="vertical"
        android:layout_width="match_parent"
        android:layout_height="match_parent">

    <fragment
            android:id="@+id/fragment_nav"
            android:name="androidx.navigation.fragment.NavHostFragment"
            app:defaultNavHost="true"
            app:navGraph="@navigation/nav_graph_demo"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintLeft_toLeftOf="parent"
            app:layout_constraintRight_toRightOf="parent"
            android:layout_width="match_parent"
            android:layout_height="match_parent"/>

</androidx.constraintlayout.widget.ConstraintLayout>
~~~

这里有几个属性：

`android:name="androidx.navigation.fragment.NavHostFragment"`

必须设置name属性，name属性的值必须是NavHostFragment（前面到取决你是否使用Android）

` app:defaultNavHost="true"`

defaultNavHost:NavGraphFragment是否会拦截系统back键，系统back键默认会关闭Activity

如果使用了toolbar，还要重写Activity的onSupportNavigateUp

~~~java
override fun onSupportNavigateUp()
        = findNavController(R.id.fragment_nav).navigateUp()
~~~

` app:navGraph="@navigation/nav_graph_main"`

navGraph：使用对应的文件，这里是nav_graph_demo（这个文件需要在res/navigatio）

**2.创建Navigation文件**

在res/navigatio文件中创建一个Navigatio resource file

然后添加对应的fragment

新版Studio可以直接使用按钮添加

![](http://ww4.sinaimg.cn/large/006y8mN6ly1g68l93h7kcj30mt0diwek.jpg)

自动生成的代码

~~~xml
<?xml version="1.0" encoding="utf-8"?>
<navigation
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:app="http://schemas.android.com/apk/res-auto"
        android:id="@+id/nav_graph_demo"
        app:startDestination="@id/navFragment1">

    <fragment
            android:id="@+id/navFragment1"
            android:name="com.yeqiu.jetpack_demo.navdemo.NavFragment1"
            android:label="NavFragment1"/>

    <fragment
            android:id="@+id/mainPage2Fragment"
            android:name="com.yeqiu.jetpack_demo.MainPage2Fragment"
            android:label="MainPage2Fragment"/>

    <fragment
            android:id="@+id/navFragment3"
            android:name="com.yeqiu.jetpack_demo.navdemo.NavFragment3"
            android:label="NavFragment3"/>

</navigation>
~~~

这里有一个很重要的属性`startDestination` 可以理解成主页，这里默认显示navFragment1

在对应的fragment添加layout属性即可在设计页面预览

~~~xml
 tools:layout="@layout/fragment_nav_1"
~~~



声明导航行为 action

设计页面可以直接点击拖动来设置跳转的activty

拖动完成后可以在xml页面稍作修改

~~~xml
<?xml version="1.0" encoding="utf-8"?>
<navigation
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:app="http://schemas.android.com/apk/res-auto"
        xmlns:tools="http://schemas.android.com/tools"
        android:id="@+id/nav_graph_demo"
        app:startDestination="@id/mainPage1Fragment1">

    <fragment
            android:id="@+id/mainPage1Fragment1"
            android:name="com.yeqiu.jetpack_demo.MainPage1Fragment"
            tools:layout="@layout/fragment_nav_1"
            android:label="MainPage1Fragment">

        <action android:id="@+id/action_to_2"
                app:destination="@id/navFragment2"/>

    </fragment>

    <fragment
            android:id="@+id/navFragment2"
            android:name="com.yeqiu.jetpack_demo.navdemo.NavFragment2"
            tools:layout="@layout/fragment_nav_2"
            android:label="NavFragment2">

        <action android:id="@+id/action_to_3"
                app:destination="@id/navFragment3"/>

    </fragment>

    <fragment
            android:id="@+id/navFragment3"
            android:name="com.yeqiu.jetpack_demo.navdemo.NavFragment3"
            tools:layout="@layout/fragment_nav_3"
            android:label="NavFragment3">

        <action android:id="@+id/action_to_1"
                app:destination="@id/mainPage1Fragment1"/>

    </fragment>

</navigation>
~~~

每个destination属性即目的地，代表要跳转的页面。id作为action的唯一表示，可以在代码中找到并指向

**3.代码中跳转**

~~~java
class NavFragment1 : Fragment() {

    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,
                              savedInstanceState: Bundle?): View {
        return inflater.inflate(R.layout.fragment_nav_1, container, false)
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        next1.setOnClickListener{
            Navigation.findNavController(it).navigate(R.id.action_to_2)
        }

    } 
}
~~~

对应的点击事件中直接使用` Navigation.findNavController(view).navigate(actionId)`,对应执行Navigatio资源文件中的跳转



**其他属性**

1.app:popUpTo -> 在fragment的action中指定，代替destination。可以直接返回刚才已经打开的fragment（从1 -> 2 -> ，如果 3直接popUpTo 1，2会直接被销毁）

2.Navigation 还支持 转场动画 

~~~mxl
  <action android:id="@+id/action_to_2"
                app:enterAnim="@anim/slide_right_in"
                app:exitAnim="@anim/slide_left_out"
                app:popEnterAnim="@anim/slide_left_in"
                app:popExitAnim="@anim/slide_right_out"
                app:destination="@id/navFragment2"/>
~~~

3.代码直接返回返回上一个fragment

~~~java
btn.setOnClickListener {
      Navigation.findNavController(it).navigateUp()
}
~~~



简单的使用到这里结束了，Navigation底层似乎是通过replace来实现页面切换的，而不是hide/show的，暂时我还不知道对首页多Fragment的情况会不会有什么影响

[Android官方架构组件Navigation：大巧不工的Fragment管理框架](https://blog.csdn.net/mq2553299/article/details/80445952)

[一个App真的只需要一个Activity](https://mp.weixin.qq.com/s/quuwF_Iz39ofYbtLbIn04w)



## Data Binding



## Lifecycles



## ViewModel



## LiveData



## Paging



## WorkManger



## Room





