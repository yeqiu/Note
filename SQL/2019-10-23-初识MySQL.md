---
layout:     post  
title:      初识MySQL 
subtitle:   MySQL
date:       2019-10-23
author:     小卷子
header-img: img/tag-bg.jpg
catalog: true
tags:
    - 标签
---

## 前言

仅仅只是记录自己学习MySQL的一些笔记和命令





### demo表

![image-20191024152324319](/Users/yeqiu/Library/Application Support/typora-user-images/image-20191024152324319.png)



![](https://tva1.sinaimg.cn/large/006y8mN6ly1g89bisfrhwj30d20emaa5.jpg)

以上两张表储存学生的基本信息和各科目的成绩。

如果需要查找某个学生的成绩，可以先通过学生基本信息表查找学号，在通过学号查找具体科目的成绩。



### 安装MySQL

mac下安装

```sql
brew install mysql
```

[安装brew](https://brew.sh/index_zh-cn.html)

安装过程会有些漫长。等待安装完成后会提示。



**启动MySQL服务**

~~~sql
mysql.server start
~~~

**首次启动需要执行安全设置**

~~~sql
mysql_secure_installation
~~~

显示如下

~~~spl  
There are three levels of password validation policy:

LOW    Length >= 8
MEDIUM Length >= 8, numeric, mixed case, and special characters
STRONG Length >= 8, numeric, mixed case, special characters and dictionary     
~~~

按照安全等级设置Root用户密码

**登录**

```sql
mysql -u root -p
```

按照提示输入密码



注意sql命令要以;结尾

**查看所有的数据库**

~~~sql
SHOW DATABASES;
~~~



**断开连接**

~~~sql
quit
exit
\q
~~~

以上三个命令都可以，输入后会提示 `Bye`说明成功，此时已经关闭客户端服务，并未关闭服务



**关闭MySQL服务**

~~~sql
mysql.server stop
~~~



### MySQL数据类型

1. 整数类型
   包括 TINYINT、SMALLINT、MEDIUMINT、INT、BIGINT，浮点数类型 FLOAT 和 DOUBLE，定点数类型 DECIMAL。
2.  日期/时间类型
   包括 YEAR、TIME、DATE、DATETIME 和 TIMESTAMP。
3. 字符串类型
   包括 CHAR、VARCHAR、BINARY、VARBINARY、BLOB、TEXT、ENUM 和 SET 等。
4. 二进制类型
   包括 BIT、BINARY、VARBINARY、TINYBLOB、BLOB、MEDIUMBLOB 和 LONGBLOB。

**数字类型**

很显然，使用的字节数越多，意味着能表示的数值范围就越大，但是也就越耗费存储空间。根据表示一个数占用字节数的不同，`MySQL`把整数划分成如下所示的类型：

| 类型         | 大小                                     | 范围（有符号）                                               | 范围（无符号）                                               |      用途       |
| :----------- | :--------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :-------------: |
| TINYINT      | 1 字节                                   | (-128，127)                                                  | (0，255)                                                     |    小整数值     |
| SMALLINT     | 2 字节                                   | (-32 768，32 767)                                            | (0，65 535)                                                  |    大整数值     |
| MEDIUMINT    | 3 字节                                   | (-8 388 608，8 388 607)                                      | (0，16 777 215)                                              |    大整数值     |
| INT或INTEGER | 4 字节                                   | (-2 147 483 648，2 147 483 647)                              | (0，4 294 967 295)                                           |    大整数值     |
| BIGINT       | 8 字节                                   | (-9,223,372,036,854,775,808，9 223 372 036 854 775 807)      | (0，18 446 744 073 709 551 615)                              |   极大整数值    |
| FLOAT        | 4 字节                                   | (-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38) | 0，(1.175 494 351 E-38，3.402 823 466 E+38)                  | 单精度 浮点数值 |
| DOUBLE       | 8 字节                                   | (-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) | 0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) | 双精度 浮点数值 |
| DECIMAL      | 对DECIMAL(M,D) ，如果M>D，为M+2否则为D+2 | 依赖于M和D的值                                               | 依赖于M和D的值                                               |     小数值      |



**日期和时间类型**

| 类型      | 大小 (字节) | 范围                                                         | 格式                | 用途                     |
| :-------- | :---------- | :----------------------------------------------------------- | :------------------ | :----------------------- |
| DATE      | 3           | 1000-01-01/9999-12-31                                        | YYYY-MM-DD          | 日期值                   |
| TIME      | 3           | '-838:59:59'/'838:59:59'                                     | HH:MM:SS            | 时间值或持续时间         |
| YEAR      | 1           | 1901/2155                                                    | YYYY                | 年份值                   |
| DATETIME  | 8           | 1000-01-01 00:00:00/9999-12-31 23:59:59                      | YYYY-MM-DD HH:MM:SS | 混合日期和时间值         |
| TIMESTAMP | 4           | 1970-01-01 00:00:00/2038结束时间是第 **2147483647** 秒，北京时间 **2038-1-19 11:14:07**，格林尼治时间 2038年1月19日 凌晨 03:14:07 | YYYYMMDD HHMMSS     | 混合日期和时间值，时间戳 |



**字符串类型**

| 类型       | 大小                | 用途                            |
| :--------- | :------------------ | :------------------------------ |
| CHAR(M)    | 0-255字节           | 固定长度字符串                  |
| VARCHAR(M) | 0-65535 字节        | 可变长度字符串                  |
| TINYBLOB   | 0-255字节           | 不超过 255 个字符的二进制字符串 |
| TINYTEXT   | 0-255字节           | 短文本字符串                    |
| BLOB       | 0-65 535字节        | 二进制形式的长文本数据          |
| TEXT       | 0-65 535字节        | 长文本数据                      |
| MEDIUMBLOB | 0-16 777 215字节    | 二进制形式的中等长度文本数据    |
| MEDIUMTEXT | 0-16 777 215字节    | 中等长度文本数据                |
| LONGBLOB   | 0-4 294 967 295字节 | 二进制形式的极大文本数据        |
| LONGTEXT   | 0-4 294 967 295字节 | 极大文本数据                    |



**ENUM类型和SET类型**

ENUM：也叫枚举类，格式如下：

~~~sql
ENUM('str1', 'str2', 'str3' ⋯)
~~~

表示只能在给定的字符串中选择一个。

SET：表示可能从给定的值里选择多个，格式如下：

~~~sql
SET('str1', 'str2', 'str3' ⋯)
~~~





### 创建数据库和表

**创建新的数据库**

```sql
CREATE DATABASE 数据库名;
```



**切换数据库**

```sql
USE 数据库名称;
```



**删除数据库 （工作环境不要操作）**

```sql
DROP DATABASE 数据库名;
```



**创建表**

创建一个表时至少需要完成下列事情：

1. 给表起个名。
2. 给表定义一些列，并且给这些列都起个名。
3. 每一个列都需要定义一种数据类型。
4. 如果有需要的话，可以给这些列定义一些列的属性，比如不许存储`NULL`，设置默认值等等。

`MySQL`中创建表的基本语法就是这样的：

```
CREATE TABLE 表名 (
    列名1    数据类型    [列的属性],
    列名2    数据类型    [列的属性],
    ...
    列名n    数据类型    [列的属性]
);
```

- 在`CREATE TABLE`后写清楚我们要创建的表的名称。
- 然后在小括号`()`中定义上这个表的各个列的信息，包括列的名称、列的数据类型，如果有需要的话也可以定义这个列的属性（列的属性用中括号`[]`引起来的意思就是这部分是可选的，也就是可有可无的）。
- 列名、数据类型、列的属性之间用空白字符分开就好，然后各个列的信息之间用逗号`,`分隔开。

~~~sql
CREATE TABLE first_table (
    first_column INT,
    second_column VARCHAR(100)
);
~~~

这个表的名称叫做`first_table`，它有两个列：

- 第一个列的名称是`first_column`，它的数据类型是`INT`，意味着只能存放整数。
- 第二个列的名称是`second_column`，它的数据类型是`VARCHAR(100)`，意味着这个列可以存放长度不超过100个字符的字符串。

创建学生表

~~~sql

~~~









**创建表时添加注释**

在创建表时将该表的用处以注释的形式添加到语句中，只要在建表语句最后加上`COMMENT`语句就好，如下：

~~~sql
CREATE TABLE 表名 (
    各个列的信息 ...
) COMMENT '表的注释信息';
~~~

例：创建学生信息表

![](https://tva1.sinaimg.cn/large/006y8mN6ly1g892brfx2nj30jt0a6wej.jpg)



学号：整数类型

姓名：字符串类型

性别：只有男女，可定义成ENUM

身份证号：最后一位可能是X，只能用字符串类型。可固定为18位

学院：字符串类型

专业：字符串类型

入学时间：日期类型

创建表的语句

~~~sql
create table student_info (
	number int,
	name varchar(10),
	sex enum('男','女'),
	id_card_number char(18),
	department varchar(20),
	major varchar(20),
	enrollment_time date
) comment'学生基本信息表';
~~~

**sql命令可以不区分大小写的。注意在创建语句表名和括号之间要加上空格**



**查看当前数据库中的所有表**

~~~sql
SHOW TABLES
~~~



**删除表**

~~~sql
DROP TABLE 表1, 表2, ..., 表n;
~~~

可以一次删除多个表

同样创建已存在的表或者删除不存在的表都会报错



**查看表结构**

以下语句都可以

~~~sql
DESCRIBE 表名;
DESC 表名;
EXPLAIN 表名;
SHOW COLUMNS FROM 表名;
SHOW FIELDS FROM 表名;
~~~



**没有选择当前数据库时对表的操作**

有时候并没有使用`USE`语句来选择当前数据库，或者在一条语句中遇到的表分散在不同的数据库中，如果想在语句中使用这些表，那么就必须显式的指定这些表所属的数据库了。比如不管当前数据库是哪个，我们都可以调用这个语句来展示对应数据库里边的表：

其他地方如果使用到表名的话，需要显式指定这个表所属的数据库，指明方式是这样的：

```sql
数据库名.表名
```



**修改表**

在表创建好之后如果对表的结构不满意，比如想增加或者删除一列，想修改某一列的数据类型或者属性，想对表名或者列名进行重命名，这些操作统统都算是修改表结构。

**修改表名**

~~~sql
1.ALTER TABLE 旧表名 RENAME TO 新表名;
2.RENAME TABLE 旧表名1 TO 新表名1, 旧表名2 TO 新表名2, ... 旧表名n TO 新表名n;
//这种改名方式可以在一条语句中修改多个表的名称。
~~~



**增加列**

~~~sql
ALTER TABLE 表名 ADD COLUMN 列名 数据类型 [列的属性];
~~~

默认的情况下列都是加到现有列的最后一列后面，我们也可以在添加列的时候指定它的位置。

~~~sql
//添加到第一列
ALTER TABLE 表名 ADD COLUMN 列名 列的类型 [列的属性] FIRST;
//添加到指定列的后边
ALTER TABLE 表名 ADD COLUMN 列名 列的类型 [列的属性] AFTER 指定列名;
~~~



**删除列**

~~~sql
ALTER TABLE 表名 DROP COLUMN 列名;
~~~



**修改列**

~~~sql
1.修改列的数据类型
ALTER TABLE 表名 MODIFY 列名 新数据类型 [新属性];
2.修改列的名字和数据类型
ALTER TABLE 表名 CHANGE 旧列名 新列名 新数据类型 [新属性];
~~~



**修改列的排列方式**

~~~sql
1.将列设为表的第一列：
ALTER TABLE 表名 MODIFY 列名 列的类型 列的属性 FIRST;
2.将列放到指定列的后边：
ALTER TABLE 表名 MODIFY 列名 列的类型 列的属性 AFTER 指定列名;
~~~



**同时操作多个修改**

~~~sql
ALTER TABLE 表名 操作1, 操作2, ..., 操作n;
~~~



### 添加数据

`MySQL`插入数据的时候是以行为单位的，语法格式如下：

~~~sql
INSERT INTO 表名(列1, 列2, ...) VALUES(列1的值，列2的值, ...);
~~~

在表明后面用小括号指定要插入的列，在VALUE后面用小括号按照顺序填入对应的值。未指定值得列默认值是null



添加完可以使用以下命名查看表中所有数据

~~~sql
SELECT * FROM 表名;
~~~



**批量添加**

~~~sql
INSERT INTO 表名(列1,列2, ...) VAULES(列1的值，列2的值, ...), (列1的值，列2的值, ...), (列1的值，列2的值, ...), ...;
~~~

用,隔开添加的列和值



### 列的属性

**默认值**

在插入的时候指定了某些列，那些没有被指定的列的值就会是null。可以在建表的时候给这个列添加默认值。

~~~sql
列名 列的类型 DEFAULT 默认值
~~~



**not null 属性**

有些时候要求表里的某些列必须有值，不能存放null。在建表时

~~~sql
列名 列的类型 NOT NULL
~~~



**主键**

在表里通过某个列来确定值的唯一性，这个列被称作候选键。之前学生信息里的学号或者身份证号都是唯一的，他们都是学生表里的候选键。一个表里可能会有多个候选键，从中选择一个候选键作为表的主键，一个表只能有一个主键，主键的值不能重复。通过主键可以找到唯一的一条记录。定义主键有一下两种方式

1.如果主键只是单个列的话，可以直接在该列后声明`PRIMARY KEY`，比如我们把学生信息表`学号`列声明为主键可以这么写：

~~~sql
CREATE TABLE student_info (
  	//声明主键
    number INT PRIMARY KEY,
    name VARCHAR(5),
    sex ENUM('男', '女'),
    id_number CHAR(18),
    department VARCHAR(30),
    major VARCHAR(30),
    enrollment_time DATE
);
~~~

2.可以把主键单独声明提出来

~~~sql
CREATE TABLE student_info (
    number INT,
    name VARCHAR(5),
    sex ENUM('男', '女'),
    id_number CHAR(18),
    department VARCHAR(30),
    major VARCHAR(30),
    enrollment_time DATE,
  	//声明主键
    PRIMARY KEY (number)
);
~~~

如果是多个列组合作为主键的话必须使用单独声明的方式，列与列用,隔开

主键默认是 not null 属性。



**UNIQUE**

对于不是主键，但是也想在插入的时候校验是否重复。可以使用UNIQUE属性，声明该列或者列组合不可重复。声明方式与声明主键相似。

~~~sql
CREATE TABLE student_info (
    number INT PRIMARY KEY,
    name VARCHAR(5),
    sex ENUM('男', '女'),
  	//声明UNIQUE
    id_number CHAR(18) UNIQUE,
    department VARCHAR(30),
    major VARCHAR(30),
    enrollment_time DATE
);

//2.UNIQUE KEY [约束名称] (列名1, 列名2, ...)

CREATE TABLE student_info (
    number INT PRIMARY KEY,
    name VARCHAR(5),
    sex ENUM('男', '女'),
    id_number CHAR(18),
    department VARCHAR(30),
    major VARCHAR(30),
    enrollment_time DATE,
 	 //声明UNIQUE
    UNIQUE KEY uk_id_number (id_number)
);
~~~

对于多个列的组合具有`UNIQUE`属性的情况，必须使用这种单独声明的形式。

声明了UNIQUE属性插入重复数据会报错。



**主键和`UNIQUE`约束的区别**

二者d欧式保证某个列或者列组合在表里的唯一性，区别在

1.一张表只能有一个主键，可以有多个UNIQUE

2.主键不能存null值，UNIQUE可以存null并且null可以重复。



**外键**

外键作为多个有依赖关系的表的约束机制。

例：查找学生的成绩依靠学生信息表里的学号，如果信息表里没有这个学号，只有成绩表中有。那就相当于插入了不知道哪个学生的成绩，这种数据显然是无用的。为了防止这种情况就有了外键约束。

定义外键

~~~sql
CONSTRAINT [外键名称] FOREIGN KEY(列1, 列2, ...) REFERENCES 父表名(父列1, 父列2, ...);
~~~

外键名称是可选的，不定义会有默认。

如果A表中的默写列依赖B表中的某些列，那A表就叫做子表，B表为父表。字表和附表可以使用外键关联。学生成绩中的例子成绩表中的学号就是依赖信息表中的学号。所以信息表是父表，成绩表是子表。

建立外键后，每次在子表中插入数据，mysql都会自动检查插入的外键是否在父表中存在，如果不存在会报错。



**AUTO_INCREMENT**

自增属性，当某列中的数据是整数或者浮点类型的时候就可以设置AUTO_INCREMENT属性。当设置AUTO_INCREMENT属性后，在插入数据的时候不指定该列的值，或者指定为null、0，那新新插入的数据值就是当前列最大值+1。

~~~sql
列名 列的类型 AUTO_INCREMENT
~~~

定义AUTO_INCREMENT属性需要注意几点

1.一个表中最多只能存在一个AUTO_INCREMENT属性的列

2.AUTO_INCREMENT列必须建立索引，主键和UNIQUE会自动建立索引。

3.AUTO_INCREMENT的列不能设置默认值

4.一般AUTO_INCREMENT的列都是作为主键，来自动生成唯一标识的值。



**列的注释**

表可以添加注释，列也可以添加注释。也是通过在末尾用COMMENT添加

~~~sql
CREATE TABLE first_table (
    id int UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '自增主键',
    first_column INT COMMENT '第一列',
    second_column VARCHAR(100) DEFAULT 'abc' COMMENT '第二列'
) COMMENT '第一个表';
~~~



**列的多属性**

每个列都可以有多个属性，在声明属性的时候用空格隔开就可以。注意有些属性是冲突的，如主键和UNIQUE







### 简单查询





### 搜索条件查询





### 表达式和函数





### 分组查询





### 子查询





### 连接查询





### 插入删除和更新





### 视图





### 自定义变量和语句结束分隔符





### 储存函数和储存过程





### 游标





###触发器和事件

