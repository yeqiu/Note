---
layout:     post  
title:      retrofit+协程 
subtitle:   retrofit 协程
date:       2019-10-17
author:     小卷子
header-img: img/tag-bg.jpg
catalog: true
tags:
    - 标签
---



###retrofit的请求

常规的写法

~~~java
val serviceApi: ServiceApi by lazy {
    getRetrofit().create(ServiceApi::class.java)
}

private fun getRetrofit(): Retrofit {
    return Retrofit.Builder()
        .baseUrl(baseUrl)
        .addConverterFactory(GsonConverterFactory.create())
        .build()
}

interface ServiceApi {
    @POST(memberLoan)
    fun getData(): Call<Data>
}

data class Data(val errorCode: Int, val message: String)
~~~

~~~kotlin
        serviceApi.getData().enqueue(object :Callback<Data>{
            override fun onFailure(call: Call<Data>, t: Throwable) {
                logThead("onFailure ${t.message}")
            }

            override fun onResponse(call: Call<Data>, response: Response<Data>) {

                logThead("onResponse ${response.body()}")
            }

        })
~~~



看起来很普通，只是在Callback的onFailure和onResponse如果在做一次网络请求或者其他的异步操作，又要套一层大括号。如果有计算或者io操作又要开启新新线程，这种蜜汁缩进很影响阅读代码。



### 改造成协程

**通过CallAdapter**